"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[571],{7571:function(t,e,a){a.r(e),a.d(e,{default:function(){return O}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"标题",fixed:""},scopedSlots:t._u([{key:"title",fn:function(){return[e("van-button",{staticClass:"search-btn",attrs:{round:"",icon:"search",type:"info",to:"/search"}},[t._v(" 搜索 ")])]},proxy:!0}])}),e("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:"","swipe-threshold":"2"},scopedSlots:t._u([{key:"nav-right",fn:function(){return[e("div",{staticClass:"placeholder"}),e("div",{staticClass:"hamburger-btn",on:{click:function(e){t.isChannelEditShow=!0}}},[e("i",{staticClass:"toutiao toutiao-gengduo"})])]},proxy:!0}]),model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("article-list",{attrs:{channel:t}})],1)})),1),e("van-popup",{staticClass:"edit-channel-popup",style:{height:"100%"},attrs:{position:"bottom",closeable:"","close-icon-position":"top-left"},model:{value:t.isChannelEditShow,callback:function(e){t.isChannelEditShow=e},expression:"isChannelEditShow"}},[e("channel-edit",{attrs:{myChannels:t.channels,active:t.active,allChannels:t.allChannels},on:{"update-active":t.onUpdateActive}})],1)],1)},s=[],i=a(432),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"artcle-list"},[e("van-pull-refresh",{attrs:{"success-text":t.refreshingText,"success-duration":"1500"},on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},refresh:t.onRefresh,load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("ArticleItem",{key:a,attrs:{article:t}})})),1)],1)],1)},r=[],c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-item"},[e("van-cell",{attrs:{to:`/article/${t.article.art_id}`},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title van-multi-ellipsis--l2"},[t._v(" "+t._s(t.article.title)+" ")])]},proxy:!0},{key:"label",fn:function(){return[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,a){return e("div",{key:a,staticClass:"cover-item"},[e("van-image",{staticClass:"right-image cover-item",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),e("div",{staticClass:"author-info"},[e("span",[t._v(t._s(t.article.aut_name))]),e("span",[t._v(t._s(t.article.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]},proxy:!0},1===t.article.cover.type?{key:"default",fn:function(){return[e("van-image",{attrs:{width:"100",height:"100",src:t.article.cover.images[0]}})]},proxy:!0}:null],null,!0)})],1)},o=[],h={name:"ArticleItem",props:{article:{type:Object,default:()=>({})}},data(){return{}},methods:{}},d=h,u=a(1001),f=(0,u.Z)(d,c,o,!1,null,"28fa99de",null),m=f.exports,p={name:"artcleList",data(){return{list:[],loading:!1,finished:!1,timesTamp:0,error:!1,refreshing:!1,refreshingText:"更新成功"}},components:{ArticleItem:m},props:{channel:{type:Object,default:()=>({})}},methods:{async onLoad(){try{const{data:t}=await(0,i.VW)({channel_id:this.channel.id,timestamp:this.timesTamp||Date.now()});this.list.push(...t.data.results),this.loading=!1,0===t.data.results.length?this.finished=!0:this.timestamp=t.data.pre_timestamp}catch(t){this.error=!0,this.loading=!1,this.$toast("接口请求失败, 稍后重试")}},async onRefresh(){try{Math.random()<.4&&JSON.parse("aaa");const{data:t}=await(0,i.VW)({channel_id:this.channel.id,timestamp:Date.now()});this.list.unshift(...t.data.results),this.refreshing=!1,this.refreshingText=`刷新成功, 更新了${t.data.results.length}条数据`}catch(t){this.refreshingText="刷新失败, 请重试",this.refreshing=!1}}}},v=p,C=(0,u.Z)(v,l,r,!1,null,"91261710",null),y=C.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-editer"},[e("van-cell",{attrs:{title:"我的频道"},scopedSlots:t._u([{key:"default",fn:function(){return[e("van-button",{staticClass:"edit-btn",attrs:{round:"",size:"mini",type:"danger",plain:""},on:{click:function(e){t.isEditShow=!t.isEditShow}}},[t._v(" "+t._s(t.isEditShow?"完成":"编辑")+" ")])]},proxy:!0}])}),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(a,n){return e("van-grid-item",{key:a.id,staticClass:"channel-item",class:{active:t.active===n},attrs:{text:a.name},on:{click:function(e){return t.onMyChannel(a,n)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEditShow&&0!==n,expression:"isEditShow && index !== 0"}],attrs:{name:"close"}})]},proxy:!0}],null,!0)})})),1),e("van-cell",{attrs:{title:"推荐频道"}}),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels_lodash,(function(a){return e("van-grid-item",{key:a.id,staticClass:"channel-item",attrs:{text:a.name,icon:"plus"},on:{click:function(e){return t.onAddChannel(a)}}})})),1)],1)},g=[],w=a(3822),x=a(7247),b={name:"channelEdit",props:{myChannels:{type:Array,default:()=>[]},allChannels:{type:Array,default:()=>[]},active:{type:Number,default:0}},data(){return{myChannelsClone:this.myChannels,isEditShow:!1}},methods:{async onAddChannel(t){if(this.myChannelsClone.push(t),this.user)try{const e=[{id:t.id,seq:this.myChannels.length-1}];await(0,i.rT)({channels:e}),this.$toast("添加成功")}catch(e){this.$toast("添加失败")}else(0,x.LS)("TOUTIAO_CHANNELS",this.myChannels)},onMyChannel(t,e){if(this.isEditShow){if(0===e)return;this.myChannelsClone.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e)},async deleteChannel(t){if(this.user)try{await(0,i.TM)(t.id)}catch(e){this.$toast("删除频道失败")}else(0,x.LS)("TOUTIAO_CHANNELS",this.myChannels)}},computed:{...(0,w.rn)(["user"]),recommendChannels(){const t=this.allChannels.filter((t=>!this.myChannels.find((e=>e.id===t.id))));return t},recommendChannels_lodash(){return this.$_.differenceBy(this.allChannels,this.myChannels,"id")}}},S=b,k=(0,u.Z)(S,_,g,!1,null,"5c7c3ed5",null),A=k.exports,E={name:"homeApp",components:{ArticleList:y,ChannelEdit:A},data(){return{active:0,channels:[],isChannelEditShow:!1,allChannels:[]}},created(){this.loadChannels(),this.loadAllChannels()},methods:{async loadChannels(){try{let t=[];const e=(0,x.rV)("TOUTIAO_CHANNELS");if(this.user||!e){const{data:e}=await(0,i.lS)();t=e.data.channels}else t=e;this.channels=t}catch(t){this.$toast("获取频道列表失败")}},async loadAllChannels(){try{const{data:t}=await(0,i.Of)();this.allChannels=t.data.channels}catch(t){this.$toast("获取频道列表失败")}},onUpdateActive(t,e=!1){this.active=t,this.isChannelEditShow=e}},computed:{...(0,w.rn)(["user"])}},T=E,$=(0,u.Z)(T,n,s,!1,null,"e54957f6",null),O=$.exports}}]);
//# sourceMappingURL=571.fcc42386.js.map